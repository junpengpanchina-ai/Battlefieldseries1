<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>图片资源测试 - 战地系列</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #f5f7fa;
            color: #2a2a2a;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, #1a1a1a, #2a2a2a);
            color: white;
            padding: 40px 0;
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #ff6b35;
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .status-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .status-card h3 {
            color: #ff6b35;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #28a745;
            animation: pulse 2s infinite;
        }

        .status-indicator.error {
            background: #dc3545;
        }

        .status-indicator.warning {
            background: #ffc107;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .image-categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
        }

        .category-section {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .category-header {
            background: #ff6b35;
            color: white;
            padding: 20px;
            text-align: center;
        }

        .category-header h3 {
            margin: 0;
            font-size: 1.5rem;
        }

        .image-grid {
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
        }

        .image-item {
            position: relative;
            aspect-ratio: 16/9;
            border-radius: 8px;
            overflow: hidden;
            background: #f8f9fa;
            border: 2px solid #e1e5e9;
            transition: all 0.3s;
        }

        .image-item:hover {
            border-color: #ff6b35;
            transform: translateY(-2px);
        }

        .image-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: opacity 0.3s;
        }

        .image-item.loading img {
            opacity: 0.5;
        }

        .image-item.error {
            border-color: #dc3545;
            background: #f8d7da;
        }

        .image-item.success {
            border-color: #28a745;
        }

        .image-status {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: white;
            font-weight: bold;
        }

        .image-status.loading {
            background: #ffc107;
        }

        .image-status.success {
            background: #28a745;
        }

        .image-status.error {
            background: #dc3545;
        }

        .image-filename {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 8px;
            font-size: 0.75rem;
            text-align: center;
        }

        .controls {
            text-align: center;
            margin: 40px 0;
        }

        .btn {
            background: #ff6b35;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            margin: 0 10px;
            transition: background-color 0.3s;
        }

        .btn:hover {
            background: #e55a2b;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #545b62;
        }

        .config-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .config-section h3 {
            color: #ff6b35;
            margin-bottom: 20px;
        }

        .config-item {
            margin-bottom: 15px;
        }

        .config-item label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #2a2a2a;
        }

        .config-item input {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1rem;
        }

        .config-item input:focus {
            outline: none;
            border-color: #ff6b35;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #ff6b35;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-info {
            background: #cce7ff;
            color: #004085;
            border: 1px solid #b3d7ff;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1>🖼️ 图片资源测试</h1>
            <p>验证云存储接口连接和图片加载状态</p>
        </div>
    </div>

    <div class="container">
        <!-- 配置区域 -->
        <div class="config-section">
            <h3>📋 接口配置</h3>
            <div class="config-item">
                <label for="apiUrl">云存储API地址</label>
                <input type="url" id="apiUrl" value="https://2776117bb412e09a1d30cbe886cd3935.r2.cloudflarestorage.com/battlefieldseries2042" readonly>
            </div>
            <div class="alert alert-info">
                <strong>当前配置：</strong> 使用Cloudflare R2存储，基础路径已设置。如需修改配置，请联系开发人员。
            </div>
        </div>

        <!-- 状态概览 -->
        <div class="status-grid">
            <div class="status-card">
                <h3><div class="status-indicator" id="apiStatus"></div> API连接状态</h3>
                <p id="apiStatusText">检测中...</p>
            </div>
            <div class="status-card">
                <h3><div class="status-indicator" id="imageStatus"></div> 图片加载状态</h3>
                <p id="imageStatusText">等待测试...</p>
            </div>
            <div class="status-card">
                <h3><div class="status-indicator success"></div> 图片管理器</h3>
                <p>已集成到所有页面，支持自动降级</p>
            </div>
        </div>

        <!-- 控制按钮 -->
        <div class="controls">
            <button class="btn" onclick="testAllImages()">
                <span class="loading-spinner" id="testSpinner" style="display: none;"></span>
                开始测试所有图片
            </button>
            <button class="btn btn-secondary" onclick="clearResults()">清除结果</button>
            <button class="btn btn-secondary" onclick="exportResults()">导出报告</button>
        </div>

        <!-- 图片分类测试 -->
        <div id="imageTestResults">
            <!-- UI图片 -->
            <div class="category-section">
                <div class="category-header">
                    <h3>🎨 UI图片 (Logo、图标等)</h3>
                </div>
                <div class="image-grid" id="uiImages"></div>
            </div>

            <!-- 背景图片 -->
            <div class="category-section">
                <div class="category-header">
                    <h3>🌅 背景图片</h3>
                </div>
                <div class="image-grid" id="backgroundImages"></div>
            </div>

            <!-- 游戏截图 -->
            <div class="category-section">
                <div class="category-header">
                    <h3>🎮 游戏截图</h3>
                </div>
                <div class="image-grid" id="gameImages"></div>
            </div>

            <!-- 新闻配图 -->
            <div class="category-section">
                <div class="category-header">
                    <h3>📰 新闻配图</h3>
                </div>
                <div class="image-grid" id="newsImages"></div>
            </div>
        </div>
    </div>

    <script>
        // 图片测试配置
        const IMAGE_CONFIG = {
            baseUrl: 'https://2776117bb412e09a1d30cbe886cd3935.r2.cloudflarestorage.com/battlefieldseries2042',
            categories: {
                ui: ['logo.png', 'favicon.ico'],
                backgrounds: ['hero-bg.jpg', 'news-bg.jpg', 'games-bg.jpg', 'media-bg.jpg'],
                games: [
                    'bf2042.jpg', 'bf2042-screenshot-1.jpg', 'bf2042-screenshot-2.jpg', 'bf2042-screenshot-3.jpg', 'bf2042-screenshot-4.jpg',
                    'bfv.jpg', 'bfv-screenshot-1.jpg', 'bfv-screenshot-2.jpg', 'bfv-screenshot-3.jpg',
                    'bf1.jpg', 'bf1-screenshot-1.jpg', 'bf1-screenshot-2.jpg', 'bf1-screenshot-3.jpg',
                    'bf4.jpg', 'bf4-screenshot-1.jpg', 'bf4-screenshot-2.jpg', 'bf4-screenshot-3.jpg'
                ],
                news: [
                    'update-s5.jpg', 'new-year-event.jpg', 'community-feedback.jpg',
                    'developer-interview.jpg', 'esports-league.jpg', 'mobile-update.jpg'
                ]
            }
        };

        let testResults = {
            total: 0,
            success: 0,
            error: 0,
            details: {}
        };

        // 初始化页面
        document.addEventListener('DOMContentLoaded', function() {
            setupImageContainers();
            testApiConnection();
        });

        // 设置图片容器
        function setupImageContainers() {
            Object.keys(IMAGE_CONFIG.categories).forEach(category => {
                const container = document.getElementById(category + 'Images');
                if (container) {
                    IMAGE_CONFIG.categories[category].forEach(filename => {
                        const imageItem = createImageItem(category, filename);
                        container.appendChild(imageItem);
                    });
                }
            });
        }

        // 创建图片项目
        function createImageItem(category, filename) {
            const item = document.createElement('div');
            item.className = 'image-item loading';
            item.id = `img-${category}-${filename.replace(/[^a-zA-Z0-9]/g, '-')}`;
            
            const img = document.createElement('img');
            img.alt = filename;
            img.style.display = 'none';
            
            const status = document.createElement('div');
            status.className = 'image-status loading';
            status.textContent = '⏳';
            
            const filename_div = document.createElement('div');
            filename_div.className = 'image-filename';
            filename_div.textContent = filename;
            
            item.appendChild(img);
            item.appendChild(status);
            item.appendChild(filename_div);
            
            return item;
        }

        // 测试API连接
        async function testApiConnection() {
            const statusIndicator = document.getElementById('apiStatus');
            const statusText = document.getElementById('apiStatusText');
            
            try {
                // 尝试加载一个测试图片来验证连接
                const testUrl = `${IMAGE_CONFIG.baseUrl}/ui/logo.png`;
                const response = await fetch(testUrl, { method: 'HEAD' });
                
                if (response.ok) {
                    statusIndicator.className = 'status-indicator success';
                    statusText.textContent = 'API连接正常，可以访问云存储资源';
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                statusIndicator.className = 'status-indicator error';
                statusText.textContent = `连接失败: ${error.message}`;
            }
        }

        // 测试所有图片
        async function testAllImages() {
            const spinner = document.getElementById('testSpinner');
            const statusIndicator = document.getElementById('imageStatus');
            const statusText = document.getElementById('imageStatusText');
            
            spinner.style.display = 'inline-block';
            statusIndicator.className = 'status-indicator warning';
            statusText.textContent = '正在测试图片加载...';
            
            // 重置结果
            testResults = { total: 0, success: 0, error: 0, details: {} };
            
            // 测试所有分类的图片
            for (const [category, files] of Object.entries(IMAGE_CONFIG.categories)) {
                testResults.details[category] = {};
                
                for (const filename of files) {
                    testResults.total++;
                    await testSingleImage(category, filename);
                }
            }
            
            // 更新总体状态
            spinner.style.display = 'none';
            if (testResults.error === 0) {
                statusIndicator.className = 'status-indicator success';
                statusText.textContent = `所有${testResults.total}张图片加载成功！`;
            } else if (testResults.success > 0) {
                statusIndicator.className = 'status-indicator warning';
                statusText.textContent = `${testResults.success}/${testResults.total}张图片加载成功`;
            } else {
                statusIndicator.className = 'status-indicator error';
                statusText.textContent = `所有${testResults.total}张图片加载失败`;
            }
        }

        // 测试单张图片
        async function testSingleImage(category, filename) {
            const itemId = `img-${category}-${filename.replace(/[^a-zA-Z0-9]/g, '-')}`;
            const item = document.getElementById(itemId);
            const img = item.querySelector('img');
            const status = item.querySelector('.image-status');
            
            const imageUrl = `${IMAGE_CONFIG.baseUrl}/${category}/${filename}`;
            
            return new Promise((resolve) => {
                const testImg = new Image();
                
                testImg.onload = () => {
                    // 加载成功
                    item.className = 'image-item success';
                    status.className = 'image-status success';
                    status.textContent = '✓';
                    img.src = imageUrl;
                    img.style.display = 'block';
                    
                    testResults.success++;
                    testResults.details[category][filename] = 'success';
                    resolve();
                };
                
                testImg.onerror = () => {
                    // 加载失败
                    item.className = 'image-item error';
                    status.className = 'image-status error';
                    status.textContent = '✗';
                    
                    testResults.error++;
                    testResults.details[category][filename] = 'error';
                    resolve();
                };
                
                // 设置超时
                setTimeout(() => {
                    if (!testImg.complete) {
                        item.className = 'image-item error';
                        status.className = 'image-status error';
                        status.textContent = '⏰';
                        
                        testResults.error++;
                        testResults.details[category][filename] = 'timeout';
                        resolve();
                    }
                }, 10000);
                
                testImg.src = imageUrl;
            });
        }

        // 清除结果
        function clearResults() {
            document.querySelectorAll('.image-item').forEach(item => {
                item.className = 'image-item loading';
                const img = item.querySelector('img');
                const status = item.querySelector('.image-status');
                
                img.style.display = 'none';
                img.src = '';
                status.className = 'image-status loading';
                status.textContent = '⏳';
            });
            
            const statusIndicator = document.getElementById('imageStatus');
            const statusText = document.getElementById('imageStatusText');
            statusIndicator.className = 'status-indicator';
            statusText.textContent = '等待测试...';
            
            testResults = { total: 0, success: 0, error: 0, details: {} };
        }

        // 导出测试报告
        function exportResults() {
            if (testResults.total === 0) {
                alert('请先运行图片测试');
                return;
            }
            
            const report = {
                timestamp: new Date().toISOString(),
                baseUrl: IMAGE_CONFIG.baseUrl,
                summary: {
                    total: testResults.total,
                    success: testResults.success,
                    error: testResults.error,
                    successRate: ((testResults.success / testResults.total) * 100).toFixed(2) + '%'
                },
                details: testResults.details
            };
            
            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `image-test-report-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html> 